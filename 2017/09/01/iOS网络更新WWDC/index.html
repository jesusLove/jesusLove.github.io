<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>iOS网络更新WWDC | 繁华落尽</title><meta name="keywords" content="iOS,WWDC"><meta name="author" content="繁华落尽丶千,jesus_lqq@163.com"><meta name="copyright" content="繁华落尽丶千"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="iOS网络更新WWDC"><meta name="application-name" content="iOS网络更新WWDC"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="iOS网络更新WWDC"><meta property="og:url" content="https://juesuslove.github.io/2017/09/01/iOS%E7%BD%91%E7%BB%9C%E6%9B%B4%E6%96%B0WWDC/index.html"><meta property="og:site_name" content="繁华落尽"><meta property="og:description" content="2015WWDC最近在恶补iOS网络相关的知识，所以从WWDC入手，本文是WWDC2015网络部分讲座，学习笔记方便日后复习，后续内容会陆续以笔记的形式发布。欢迎大家一起学习😆！ 网络和URL会话（Networking with NSURLSession） 主要内容  网络传输安全问题 UR"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2023/11/03/6544702016eb3.png?_r_=99893846-ae43-7095-dd4d-f1798b97798f"><meta property="article:author" content="繁华落尽丶千"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/11/03/6544702016eb3.png?_r_=99893846-ae43-7095-dd4d-f1798b97798f"><meta name="description" content="2015WWDC最近在恶补iOS网络相关的知识，所以从WWDC入手，本文是WWDC2015网络部分讲座，学习笔记方便日后复习，后续内容会陆续以笔记的形式发布。欢迎大家一起学习😆！ 网络和URL会话（Networking with NSURLSession） 主要内容  网络传输安全问题 UR"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://juesuslove.github.io/2017/09/01/iOS%E7%BD%91%E7%BB%9C%E6%9B%B4%E6%96%B0WWDC/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?bcdcd5cded4b5569656706ab1db4678e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"api","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 繁华落尽丶千","link":"链接: ","source":"来源: 繁华落尽","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  shortcutKey: {"enable":true,"delay":100,"shiftDelay":200},
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '繁华落尽',
  title: 'iOS网络更新WWDC',
  postAI: '',
  pageFillDescription: '2015WWDC, 1 网络传输安全问题, 1.1 URL会话和HTTP协议的背景, 1.2 App Transport Security, 1.3 URLSession添加了哪些新的协议, 1.4 URLSession API变化, 2. 补充, 2.1 知识点, 3 Reference, 2017WWDC, 1. Advances in Networking Part 1, 1.1 ECN (显式拥塞通知), 1.2 IPv6 x2F NAT64, 1.3 User-Space Networking（用户空间网络）, 1.4 Network Extension, 1.5 多路径协议, 2. Advances in Networking Part 2, 2.1  URLSession介绍, 2.2 URLSession Adaptable Connectivity API, 2.3 URLSessionTask Scheduling API, 2.4 URLSession的改进, 2.4.1 URLSessionTask Progress Tracking, 2.4.2 URLSessionTask Adopts ProgressReporting, 2.4.3 URLSession Brotli Support, 2.4.4 URLSession Public Suffix List, 2.4.5 URLSessionStreamTask最近在恶补网络相关的知识所以从入手本文是网络部分讲座学习笔记方便日后复习后续内容会陆续以笔记的形式发布欢迎大家一起学习网络和会话主要内容网络传输安全问题添加了哪些新特性变化视频地址网络传输安全问题会话和协议的背景是一个网络主要用于从网站下载内容大量的委托方法可以用来处理认证或者其他重要的事情另外可以在没有后台下载的情况下做网络层任务使用明码进行数据传输存在安全问题解决了的安全问题的本质是的上一层协议属于传输层安全协议传输层安全协议会通过公钥密码学方式进行一个多点的信号交换之后创建一个安全的连接所谓的安全性是基于三个属性来讲的加密网络上传输的数据是被加密过的完整提供消息完整性参数所以消息在检测之前是不可修改的验证支持身份验证可以验证对话对象关于和的详情内容请看从到变迁是的一个新功能从本质上讲其核心是防止用户的个人隐私数据被意外泄露加强了会话的默认方法什么是不允许明码进行加载只使用连接对进行了限制其中密码组合信任证书证书密钥的大小等都是作为限制条件通过进行配置在特殊情况下也可以加载需要配置将特殊的地址添加到里面另外可以设置这时可以加载和可以对特定资源进行保护添加了哪些新的协议支持协议为什么需要有什么问题的问题每一个连接只有一个优先请求管道并不适用于所有的服务器或网络大多数主流网页浏览器都是禁止的多个连接增加服务器资源开销缺少头压缩协议的重要的功能仅支持一台主机开放一个连接减少服务器资源开销完全多路复用多个请求合并到同一个连接中有请求优先级所以重要资源可以优先提供给有用更高权限的客户端是一个二进制协议数据处理和解析速度更快使用头压缩机制没有头压缩多路复用如何解决队首阻塞问题的头压缩机制基于两个表静态表和动态表静态表中包含常用的信息头并且不可修改动态表可以通过指针应用静态表内容协议在程序中的适配性被无缝集成到的中只需要支持的服务器变化分享在和扩展之间默认情况下和扩展的存在不同的位置可以使用程序组来访问共享数据存储其这些存储器无论还是扩展都可以访问可以创建一个与组存储器相关的存储创建一个所有的操作都会被存到这个组中在底层提取文件直接在连接上相对和的优点异步读写接口只需设置一个委托监听事件自动通过代理支持连接可以通过主机名和端口号创建一个连接补充知识点传输层安全协议及其前身安全套接触是一种安全协议目的是为互联网通信提供安全及数据完整性保障是的一个算法用于头部压缩本文是网络部分讲座两个部分的学习笔记本文是学习过程中的笔记方便日后复习后续内容会陆续以笔记的形式发布欢迎大家一起学习视频地址第一部分介绍近几年工作中技术的更新显式拥塞通知是一个对网际协议和传输控制协议的扩展定义为允许拥塞控制的端对端通知而避免丢包新兴的互联网协议中网络堆栈的一些变化和一些可以网络扩展的新工具关于多路径协议介绍是多路径设备显式拥塞通知允许拥塞控制的端对端通知而避免丢包通常情况下网络通过丢弃数据包来表明信道阻塞在成功协商的情况下感知路由器可以在头中设置一个标记来代替丢弃数据包以表明阻塞即将发生数据包的接收端回应发送端发送端降低其传输速率如同检测到丢包那样是一种转换机制他通过一种网络地址转换形式促成与主机之间的通信开发中使用高层的网络框架例如避免单独使用地址由于目前所占比重较大所以服务器同时支持和这种成为双栈连接对于仅支持的应用不能使用地址可以通过进行转换用户空间网络网络栈演变从内核空间到用户空间是在提出的如下图在中介绍了包含四个部分允许配置设备上的堆栈允许构建自己的协议自定义设备如何验证热点允许建立一个安全的基于设备的内容过滤器新增配置和代理如下图热点配置例如自动加入到智能相机的中而不需要输入密码等复杂操作代码实现例子接收系统查询信息并处理他们发送到选择的迭代解析器中或者可以发送选择的协议中例如或者多路径协议场景当我们在环境下进行数据传输在逐渐远离环境随着信号的减弱传输最终停止检测到进入蜂窝网络或者重新进入环境继续进行网络传输上述场景看起来没问题但是由于不知道何时会断开网络所以需要保存传输状态并且增加了资源消耗和降低了传输效率出现目的解决上述问题原理当我们在信号不理想的环境下就被开启触发时机边缘比较信号和蜂窝网络信号强弱优胜劣汰信号逐渐强于蜂窝网络信号已经集成到中参考视频多路径协议多路径协议是专为移动网路设计的协议由提出提供了和完全一样的服务它是建立在之上的所以可以无缝对接建立在之上可靠拥塞控制提供了和蜂窝的无缝对接帮助选择最佳的网络连接实现在下方当通过发送数据时经过堆栈负责将这些数据规划选择通过或蜂窝网络发送它是如何实现网络选择的通过创建子数据流实现的子数据流实际上是完整的连接负责创建和销毁子数据流通过管理子数据流实现数据实时传输在已经实现了开放使用它需要条件注意需要服务器支持两种模式交接模式提供可靠的长连接交互模式使用的是交互模式针对延迟敏连接感交接模式数据连接从到蜂窝网络切换以及从蜂窝网络移回当网络不好时会创建子数据流通过蜂窝网络传输数据此时子数据流未销毁当网络变好会切换到子数据流并销毁蜂窝网络子数据流注意对蜂窝数据设置了上限达到上限停止使用交互模式主要目的降低延迟与交接模式不同的是在网络变好不会立即切换配置注意还需要在中添加第二部内容的新进展和新的介绍是易用的网络支持所有平台替代过时的具体看监控连接通过开启它告诉任务由于无法连接而失败它应该等待与服务器的连接而不是直接失败开启方法设置属性新的方法只用在中配置打开才可以用并且只会回调一次示例代码在未运行的状态下上传和下载数据后台刷新什么是后台刷新在未启动的时候可以刷新数据减少启动时数据刷新等待时间在运行时设置在后台刷新需要更新的数据关闭时更新数据打开看到后台刷新的数据上述方法存在几个问题额外的影响电池寿命无法预知未来的变化请求下来数据可能无用数据包大小问题为了解决上述问题提出了调度为新属性设置一个时间允许任务准备好开始运行添加这个属性上述后台刷新则变为新的方法当系统准备联网有机会改变请求指定的传输数据量可以让系统更好的进行调度的两个新属性给出最适当的值或者设定为下面看一下示例代码的改进更新内容进度更新压缩公开后缀列表更新和认证代理旧的进度计算的额外的工作键值观察设置不总是可用新的协议普通和指定的进度描述可以添加到或者通过使用父进度对象来进行多个任务键值观察和绑定和对象状态管理数据压缩允许直接连接可选安全握手转换能力建议新代码中使用验证代理的导航拓展传输层安全协议及其前身安全套接触是一种安全协议目的是为互联网通信提供安全及数据完整性保障',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-02 15:25:29',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://bu.dusays.com/2021/01/15/419597cf3b2ff.png"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">繁华落尽</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于我</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/images/wechatpay.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/wechatpay.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/images/alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Alamofire/" style="font-size: 1.05rem;">Alamofire<sup>1</sup></a><a href="/tags/CoreAnimation/" style="font-size: 1.05rem;">CoreAnimation<sup>1</sup></a><a href="/tags/Electron/" style="font-size: 1.05rem;">Electron<sup>2</sup></a><a href="/tags/Flexbox/" style="font-size: 1.05rem;">Flexbox<sup>1</sup></a><a href="/tags/Git/" style="font-size: 1.05rem;">Git<sup>3</sup></a><a href="/tags/Git%E9%97%AE%E9%A2%98/" style="font-size: 1.05rem;">Git问题<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>8</sup></a><a href="/tags/Koa/" style="font-size: 1.05rem;">Koa<sup>2</sup></a><a href="/tags/Node-js/" style="font-size: 1.05rem;">Node.js<sup>1</sup></a><a href="/tags/Python3/" style="font-size: 1.05rem;">Python3<sup>8</sup></a><a href="/tags/Runtime/" style="font-size: 1.05rem;">Runtime<sup>2</sup></a><a href="/tags/Swift/" style="font-size: 1.05rem;">Swift<sup>5</sup></a><a href="/tags/TypeScript/" style="font-size: 1.05rem;">TypeScript<sup>4</sup></a><a href="/tags/Vue-js/" style="font-size: 1.05rem;">Vue.js<sup>2</sup></a><a href="/tags/iOS/" style="font-size: 1.05rem;">iOS<sup>18</sup></a><a href="/tags/this-%E7%BB%91%E5%AE%9A/" style="font-size: 1.05rem;">this 绑定<sup>1</sup></a><a href="/tags/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/" style="font-size: 1.05rem;">事件循环<sup>1</sup></a><a href="/tags/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE/" style="font-size: 1.05rem;">作用域链<sup>1</sup></a><a href="/tags/%E5%8E%9F%E5%9E%8B/" style="font-size: 1.05rem;">原型<sup>1</sup></a><a href="/tags/%E5%8E%9F%E5%9E%8B%E9%93%BE/" style="font-size: 1.05rem;">原型链<sup>2</sup></a><a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/" style="font-size: 1.05rem;">响应式原理<sup>2</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE/" style="font-size: 1.05rem;">基础数据<sup>1</sup></a><a href="/tags/%E5%AF%B9%E8%B1%A1/" style="font-size: 1.05rem;">对象<sup>1</sup></a><a href="/tags/%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF/" style="font-size: 1.05rem;">开机自启<sup>1</sup></a><a href="/tags/%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1/" style="font-size: 1.05rem;">异步任务<sup>1</sup></a><a href="/tags/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87/" style="font-size: 1.05rem;">执行上下文<sup>1</sup></a><a href="/tags/%E6%89%A7%E8%A1%8C%E6%A0%88/" style="font-size: 1.05rem;">执行栈<sup>1</sup></a><a href="/tags/%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0/" style="font-size: 1.05rem;">构造函数<sup>1</sup></a><a href="/tags/%E6%A0%87%E5%87%86%E5%BA%93/" style="font-size: 1.05rem;">标准库<sup>1</sup></a><a href="/tags/%E6%A8%A1%E5%9D%97/" style="font-size: 1.05rem;">模块<sup>2</sup></a><a href="/tags/%E6%B3%9B%E5%9E%8B/" style="font-size: 1.05rem;">泛型<sup>1</sup></a><a href="/tags/%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/" style="font-size: 1.05rem;">深浅拷贝<sup>1</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F%E6%89%98%E7%9B%98/" style="font-size: 1.05rem;">系统托盘<sup>1</sup></a><a href="/tags/%E7%BB%A7%E6%89%BF/" style="font-size: 1.05rem;">继承<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%BA%93/" style="font-size: 1.05rem;">网络库<sup>1</sup></a><a href="/tags/%E8%A7%A3%E6%9E%90%E5%BA%93/" style="font-size: 1.05rem;">解析库<sup>1</sup></a><a href="/tags/%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/" style="font-size: 1.05rem;">输入输出<sup>1</sup></a><a href="/tags/%E9%97%AD%E5%8C%85/" style="font-size: 1.05rem;">闭包<sup>1</sup></a><a href="/tags/%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/" style="font-size: 1.05rem;">高级特性<sup>2</sup></a><a href="/tags/%E9%AB%98%E7%BA%A7%E7%B1%BB%E5%9E%8B/" style="font-size: 1.05rem;">高级类型<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/07/"><span class="card-archive-list-date">七月 2020</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2019/11/"><span class="card-archive-list-date">十一月 2019</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2019/10/"><span class="card-archive-list-date">十月 2019</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2019/03/"><span class="card-archive-list-date">三月 2019</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2019/02/"><span class="card-archive-list-date">二月 2019</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2018/10/"><span class="card-archive-list-date">十月 2018</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2018/09/"><span class="card-archive-list-date">九月 2018</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div><div class="console-btn-item" id="consoleKeyboard" onclick="anzhiyu.keyboardToggle()" title="快捷键开关"><a class="keyboard-switch"><i class="anzhiyufont anzhiyu-icon-keyboard"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%A7%BB%E5%8A%A8%E7%AB%AF/" itemprop="url">移动端</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/iOS/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>iOS</span></a><a class="article-meta__tags" href="/tags/WWDC/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>WWDC</span></a></span></div></div><h1 class="post-title" itemprop="name headline">iOS网络更新WWDC</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2017-09-01T04:13:04.000Z" title="发表于 2017-09-01 12:13:04">2017-09-01</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-11-02T07:25:29.450Z" title="更新于 2023-11-02 15:25:29">2023-11-02</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">3.2k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>11分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="iOS网络更新WWDC"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为山东"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>山东</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://bu.dusays.com/2023/11/03/6544702016eb3.png?_r_=99893846-ae43-7095-dd4d-f1798b97798f"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://juesuslove.github.io/2017/09/01/iOS%E7%BD%91%E7%BB%9C%E6%9B%B4%E6%96%B0WWDC/"><header><a class="post-meta-categories" href="/categories/%E7%A7%BB%E5%8A%A8%E7%AB%AF/" itemprop="url">移动端</a><a href="/tags/iOS/" tabindex="-1" itemprop="url">iOS</a><a href="/tags/WWDC/" tabindex="-1" itemprop="url">WWDC</a><h1 id="CrawlerTitle" itemprop="name headline">iOS网络更新WWDC</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">繁华落尽丶千</span><time itemprop="dateCreated datePublished" datetime="2017-09-01T04:13:04.000Z" title="发表于 2017-09-01 12:13:04">2017-09-01</time><time itemprop="dateCreated datePublished" datetime="2023-11-02T07:25:29.450Z" title="更新于 2023-11-02 15:25:29">2023-11-02</time></header><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-daf458fb4a9dabc2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<span id="more"></span>

<h1 id="2015WWDC"><a href="#2015WWDC" class="headerlink" title="2015WWDC"></a>2015WWDC</h1><p>最近在恶补iOS网络相关的知识，所以从WWDC入手，本文是WWDC2015网络部分讲座，学习笔记方便日后复习，后续内容会陆续以笔记的形式发布。欢迎大家一起学习😆！</p>
<p><strong>网络和URL会话（Networking with NSURLSession）</strong></p>
<p>主要内容</p>
<ul>
<li>网络传输安全问题</li>
<li>URLSession添加了哪些新特性</li>
<li>URLSession API变化</li>
</ul>
<p>视频地址: <strong><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2015/711/">Networking with NSURLSession</a></strong></p>
<h2 id="1-网络传输安全问题"><a href="#1-网络传输安全问题" class="headerlink" title="1 网络传输安全问题"></a>1 网络传输安全问题</h2><h3 id="1-1-URL会话和HTTP协议的背景"><a href="#1-1-URL会话和HTTP协议的背景" class="headerlink" title="1.1 URL会话和HTTP协议的背景"></a>1.1 URL会话和HTTP协议的背景</h3><p><strong>URLSession</strong></p>
<ul>
<li>URLSession是一个网络API，主要用于从网站下载HTTP内容。</li>
<li>大量的委托方法（Delegate），可以用来处理认证或者其他重要的事情</li>
<li>另外，可以在没有后台下载API的情况下做网络层任务</li>
</ul>
<p><strong>HTTP&#x2F;HTTPS</strong></p>
<p>HTTP使用明码（cleartext）进行数据传输，存在安全问题。HTTPS解决了HTTP的安全问题，HTTPS的本质是HTTP的上一层协议，属于传输层安全协议，传输层安全协议会通过公钥密码学方式进行一个多点的信号交换之后，创建一个安全的连接。</p>
<p>所谓的安全性是基于三个属性来讲的：</p>
<ul>
<li>Encryption(加密)：网络上传输的数据是被加密过的。</li>
<li>Integrity（完整）：提供消息完整性参数，所以消息在检测之前是不可修改的</li>
<li>Authentication（验证）：支持身份验证，可以验证对话对象</li>
</ul>
<p>关于HTTP1.1和HTTP2的详情内容请看【**<a target="_blank" rel="noopener" href="http://www.jianshu.com/p/5db20e9cc714">从 HTTP1.x 到 HTTP 2.0 变迁</a>**】</p>
<h3 id="1-2-App-Transport-Security"><a href="#1-2-App-Transport-Security" class="headerlink" title="1.2 App Transport Security"></a>1.2 App Transport Security</h3><p>App Transport Security（ATS） 是iOS9的一个新功能，从本质上讲其核心是防止用户的个人隐私数据被意外泄露。ATS加强了URL会话的默认方法。</p>
<p>什么是ATS？</p>
<ul>
<li><p>不允许明码HTTP进行加载，只使用HTTPS连接，对TLS进行了限制，其中密码组合，信任证书，证书密钥的大小等都是作为限制条件。</p>
</li>
<li><p>通过info.plist进行配置ATS<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-563de33222f98d19.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ATS配置.png"></p>
</li>
<li><p>在特殊情况下ATS也可以加载HTTP，需要配置<code>NSExceptionDomains</code>,将特殊的URL地址添加到里面</p>
</li>
<li><p>另外，可以设置<code>NSAllowsArbitraryLoads = YES</code>，这时ATS可以加载HTTP和HTTPS。可以对特定资源进行保护<code>NSExceptionAllowsInsecureHTTPLoads = NO</code>。</p>
</li>
</ul>
<h2 id="1-3-URLSession添加了哪些新的协议"><a href="#1-3-URLSession添加了哪些新的协议" class="headerlink" title="1.3 URLSession添加了哪些新的协议"></a>1.3 URLSession添加了哪些新的协议</h2><p>URLSession支持HTTP&#x2F;2协议。</p>
<p>为什么需要HTTP&#x2F;2,HTTP&#x2F;1.1有什么问题？</p>
<p>HTTP&#x2F;1.1的问题</p>
<ul>
<li>每一个TCP连接只有一个优先请求</li>
<li>HTTP管道并不适用于所有的服务器或网络，大多数主流网页浏览器都是禁止的。</li>
<li>多个连接，增加服务器资源开销</li>
<li>缺少头压缩</li>
</ul>
<p>HTTP&#x2F;2协议的重要的功能？</p>
<ul>
<li>HTTP&#x2F;2仅支持一台主机开放一个TCP连接，减少服务器资源开销</li>
<li>HTTP&#x2F;2完全多路复用，多个请求合并到同一个TCP连接中</li>
<li>HTTP&#x2F;2有请求优先级，所以重要资源可以优先提供给有用更高权限的客户端。</li>
<li>HTTP&#x2F;2是一个二进制协议，数据处理和解析速度更快</li>
<li>HTTP&#x2F;2使用<code>HPACK</code>头压缩机制，HTTP&#x2F;1.1没有头压缩</li>
</ul>
<p>HTTP&#x2F;2多路复用如何解决队首阻塞问题？</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-19dba3fc09b13527.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="HTTP:2解决队首阻塞问题.png"></p>
<p>HTTP&#x2F;2的头压缩机制（HPACK）</p>
<p><code>HPACK</code>基于两个表静态表和动态表。静态表中包含常用的HTTP信息头并且不可修改，动态表可以通过指针应用静态表内容。</p>
<p>HTTP&#x2F;2协议在程序中的适配性？</p>
<p>HTTP&#x2F;2被无缝集成到URLSession的API中，只需要支持HTTP&#x2F;2的服务器。</p>
<h2 id="1-4-URLSession-API变化"><a href="#1-4-URLSession-API变化" class="headerlink" title="1.4 URLSession API变化"></a>1.4 URLSession API变化</h2><p><strong>HTTPCookieStorage</strong></p>
<p>分享cookie在APPs和扩展之间</p>
<ul>
<li>默认情况下，APP和扩展的cookie存在不同的位置。</li>
<li>可以使用程序组来访问共享数据存储其，这些存储器无论APP还是扩展都可以访问。</li>
<li>HTTPCookieStorage可以创建一个与组存储器相关的cookie存储。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let ident = &quot;group.mycompany.mygroupname&quot;</span><br><span class="line">let cookieStorage = HTTPCookieStorage.sharedCookieStorage(forGroupContainerIdentifier: ident)</span><br><span class="line">let config = URLSessionConfiguration.default</span><br><span class="line">        config.httpCookieStorage = cookieStorage</span><br><span class="line">let session = URLSession(configuration: config)</span><br></pre></td></tr></table></figure>
<p>创建一个cookieStorage，所有的操作都会被存到这个cookie组中。</p>
<p><strong>URLSessionStreamTask</strong> </p>
<p>在底层提取文件直接在TCP连接上。</p>
<p>相对NSInputStream和NSOutputStream的优点</p>
<ul>
<li>异步读写接口，只需设置一个委托监听事件。</li>
<li>自动通过HTTP代理</li>
</ul>
<p>支持TCP&#x2F;IP连接</p>
<ul>
<li>可以通过主机名和端口号创建一个连接</li>
</ul>
<h2 id="2-补充"><a href="#2-补充" class="headerlink" title="2. 补充"></a>2. 补充</h2><h3 id="2-1-知识点"><a href="#2-1-知识点" class="headerlink" title="2.1 知识点"></a>2.1 知识点</h3><ul>
<li><strong>TLS</strong> ： 传输层安全协议（Transport Layer Security），及其前身<strong>安全套接触</strong>（Secure Sockert Layer, SSL）是一种安全协议，目的是为互联网通信，提供安全及数据完整性保障。</li>
<li><strong>HPACK</strong> : 是HTTP&#x2F;2的一个算法，用于HTTP头部压缩。</li>
</ul>
<h2 id="3-Reference"><a href="#3-Reference" class="headerlink" title="3 Reference"></a>3 Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html">URLSession Programming Guide</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/documentation/NetworkingInternetWeb/Conceptual/NetworkingOverview/Introduction/Introduction.html#//apple_ref/doc/uid/TP40010220-CH12-BBCFIHFH">About Networking</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/foundation/urlsessionconfiguration">URLSessionConfiguration</a></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-43170761dd8a8b3c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<h1 id="2017WWDC"><a href="#2017WWDC" class="headerlink" title="2017WWDC"></a>2017WWDC</h1><p>本文是WWDC2017网络部分讲座两个部分的学习笔记。本文是学习过程中的笔记方便日后复习，后续内容会陆续以笔记的形式发布。欢迎大家一起学习😆！</p>
<h1 id="1-Advances-in-Networking-Part-1"><a href="#1-Advances-in-Networking-Part-1" class="headerlink" title="1. Advances in Networking Part 1"></a>1. Advances in Networking Part 1</h1><p>视频地址：<a href="">Advances in Networking Part 1</a><br>第一部分，介绍近几年工作中技术的更新。</p>
<ul>
<li>ECN(Explicit Congestion Notification）显式拥塞通知，是一个对网际协议和传输控制协议（TCP）的扩展，定义为RFC 3168。ECN允许拥塞控制的端对端通知而避免丢包。</li>
<li>IPv6&amp;NAT64新兴的互联网协议</li>
<li>iOS中网络堆栈的一些变化和一些可以网络扩展的新工具</li>
<li>关于多路径协议介绍，iPhone是多路径设备。</li>
</ul>
<h2 id="1-1-ECN-显式拥塞通知"><a href="#1-1-ECN-显式拥塞通知" class="headerlink" title="1.1 ECN (显式拥塞通知)"></a>1.1 ECN (显式拥塞通知)</h2><p>ECN允许拥塞控制的端对端通知而避免丢包。通常情况下，TCP&#x2F;IP 网络通过丢弃数据包来表明信道阻塞。在ECN成功协商的情况下，ECN感知路由器可以在IP头中设置一个标记来代替丢弃数据包，以表明阻塞即将发生。数据包的接收端回应发送端，发送端降低其传输速率，如同检测到丢包那样。</p>
<h2 id="1-2-IPv6-NAT64"><a href="#1-2-IPv6-NAT64" class="headerlink" title="1.2 IPv6 &#x2F; NAT64"></a>1.2 IPv6 &#x2F; NAT64</h2><p>NAT64是一种IPv6转换机制，他通过一种网络地址转换（NAT）形式促成IPv6与IPv4主机之间的通信。<br>iOS开发中，使用高层的网络框架，例如URLSession、CFNetwork。避免单独使用IPv4地址。</p>
<p>由于目前IPv4所占比重较大，所以服务器同时支持IPv6和IPv4，这种成为（Dual-Stack）双栈连接。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-f86a9e9ad67514de.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Dual-Stack.png"></p>
<p>对于仅支持IPv6的应用，不能使用IPv4地址。可以通过NAT64进行转换。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-8823c8e9ba98525e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="NAT64.png"></p>
<h2 id="1-3-User-Space-Networking（用户空间网络）"><a href="#1-3-User-Space-Networking（用户空间网络）" class="headerlink" title="1.3 User-Space Networking（用户空间网络）"></a>1.3 User-Space Networking（用户空间网络）</h2><p>网络栈演变（Network Stack）<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-50960ed5d24a9df3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="NetworkStackEvolution_1.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-df15063922a80931.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="NetworkStackEvolution_2.png"></p>
<p>TCP&#x2F;IPv6 从内核空间到用户空间。</p>
<h2 id="1-4-Network-Extension"><a href="#1-4-Network-Extension" class="headerlink" title="1.4 Network Extension"></a>1.4 Network Extension</h2><p>NetworkExtension是在WWDC2015提出的，如下图：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-0054f4cc0db05f51.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="NetworkExtension.png"><br>在WWDC2015<a href="">What’s New in Network Extension and VPN</a>中，介绍了NetworkExtension。包含四个部分：</p>
<ul>
<li>NEVPNManager 允许配置设备上的VPN堆栈。</li>
<li>NETunnelProvider 允许构建自己的VPN协议</li>
<li>NEHotspotHelper 自定义设备如何验证Wi-Fi热点</li>
<li>NEFilterProvider 允许建立一个安全的基于设备的内容过滤器</li>
</ul>
<p>新增APIs，Wi-Fi 配置和DNS 代理，如下图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-d6212837489a4991.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="NetworkExtensionNew.png"></p>
<ul>
<li>NEHotspotConfiguration：热点配置，例如，自动加入到智能相机的Wi-Fi中，而不需要输入密码等复杂操作。</li>
</ul>
<p>代码实现例子：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-640b96ef48128af2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="NetworkExtensionWiFiConfigurationAPI.png"></p>
<ul>
<li>NEDNSProxyProvider</li>
</ul>
<p>接收系统DNS查询信息，并处理他们。发送到选择的迭代解析器中，或者可以发送选择的协议中，例如，TLS或者HTTP。</p>
<h2 id="1-5-多路径协议"><a href="#1-5-多路径协议" class="headerlink" title="1.5 多路径协议"></a>1.5 多路径协议</h2><p>场景：</p>
<p>当我们在WiFi环境下进行数据传输，在逐渐远离WiFi环境，随着信号的减弱传输最终停止，检测到进入蜂窝网络或者重新进入WiFi环境，继续进行网络传输。</p>
<p>上述场景看起来没问题，但是由于不知道何时会断开网络，所以需要保存传输状态并且增加了资源消耗和降低了传输效率。</p>
<p>**Wi-Fi Assist **</p>
<p>iOS9 出现Wi-Fi Assist目的解决上述问题。原理：当我们在Wi-Fi信号不理想的环境下Wi-Fi就被开启。</p>
<p>触发时机：</p>
<ul>
<li>边缘Wi-Fi，比较Wi-Fi信号和蜂窝网络信号强弱（优胜劣汰）。</li>
<li>Wi-Fi信号逐渐强于蜂窝网络信号。</li>
</ul>
<p>Wi-Fi Assist 已经集成到URLSession APIs中。</p>
<p>参考视频：</p>
<ul>
<li><a href="">Your App and Next Generation Networks-WWDC 2015</a></li>
<li><a href="">Networking for the Modern Internet - WWDC 2016</a></li>
</ul>
<p><strong>Multipath TCP (多路径协议）</strong></p>
<p>多路径协议是专为移动网路设计的协议。由IEIF提出，提供了和TCP完全一样的服务，它是建立在TCP之上的，所以可以无缝对接。</p>
<p>Multipath TCP (MPTCP - RFC 6824 “TCP Extension for Multipath Operation”)</p>
<ul>
<li>建立在TCP之上，可靠，拥塞控制。</li>
<li>提供了Wi-Fi和蜂窝的无缝对接。</li>
<li>帮助选择最佳的网络连接。</li>
</ul>
<p>Multipath TCP 实现</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-8b41d79be824ef34.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Multipath TCP.png"></p>
<p>MPTCP在URLSession下方，当通过URLSession发送数据时经过MPTCP堆栈，MPTCP负责将这些数据规划，选择通过Wi-Fi或蜂窝网络发送。</p>
<p>它是如何实现网络选择的？</p>
<p>通过创建TCP子数据流实现的，TCP子数据流实际上是完整的TCP连接。MPTCP负责创建和销毁TCP子数据流，通过管理子数据流实现数据实时传输。</p>
<p>在iOS 7 Siri已经实现了Multipath TCP。</p>
<p><strong>Multipath TCP APIs</strong></p>
<p>iOS 11 开放Multipath TCP API，使用它需要条件。</p>
<blockquote>
<p> 注意：需要服务器支持</p>
</blockquote>
<p>MPTCP两种模式</p>
<ul>
<li>Handover Model (交接模式) ： 提供可靠的长连接</li>
<li>Interactive Model (交互模式) ： Siri使用的是交互模式，针对延迟敏连接感</li>
</ul>
<blockquote>
<p>Handover Model (交接模式)</p>
</blockquote>
<p>数据连接从Wi-Fi到蜂窝网络切换，以及从蜂窝网络移回Wi-Fi。当Wi-Fi网络不好时，MPTCP会创建TCP子数据流，通过蜂窝网络传输数据，此时Wi-Fi子数据流未销毁。当Wi-Fi网络变好MPTCP会切换到Wi-Fi子数据流，并销毁蜂窝网络子数据流。</p>
<p>注意：Wi-Fi Assist 对蜂窝数据设置了上限。达到上限停止使用。</p>
<blockquote>
<p>Interactive Model (交互模式)</p>
</blockquote>
<p>主要目的降低延迟，与交接模式不同的是在Wi-Fi网络变好，不会立即切换。</p>
<p><strong>URLSessionConfiguration配置MPTCP</strong><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-8fb49ec7af5ddd5d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="URLSession配置MPTCP"></p>
<p>注意：还需要在Xcode中添加<code>Multipath</code>。</p>
<h1 id="2-Advances-in-Networking-Part-2"><a href="#2-Advances-in-Networking-Part-2" class="headerlink" title="2. Advances in Networking Part 2"></a>2. Advances in Networking Part 2</h1><p>第二部内容：URLSession的新进展和新的API。</p>
<h2 id="2-1-URLSession介绍"><a href="#2-1-URLSession介绍" class="headerlink" title="2.1  URLSession介绍"></a>2.1  URLSession介绍</h2><p>URLSession是易用的网络API，支持Apple所有平台，替代过时的NSURLConnection API。</p>
<p>具体看**<a href="">2013&amp;2014-What’s New in Foundation Networking</a>**</p>
<h2 id="2-2-URLSession-Adaptable-Connectivity-API"><a href="#2-2-URLSession-Adaptable-Connectivity-API" class="headerlink" title="2.2 URLSession Adaptable Connectivity API"></a>2.2 URLSession Adaptable Connectivity API</h2><p>监控连接，通过开启它告诉URLSession，任务由于无法连接而失败，它应该等待与服务器的连接，而不是直接失败。</p>
<p>开启方法：设置URLSessionConfiguration属性<code>var waitsForConnectivity: Bool</code>。</p>
<p>新的URLSessionTaskDelegate方法 <code>urlSession(_:taskIsWaitingForConnectivity:)</code>只用在URLSession中配置打开才可以用，并且只会回调一次。</p>
<p>示例代码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-c668fac86e65311b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="URLSession配置waitConnectivity"></p>
<h2 id="2-3-URLSessionTask-Scheduling-API"><a href="#2-3-URLSessionTask-Scheduling-API" class="headerlink" title="2.3 URLSessionTask Scheduling API"></a>2.3 URLSessionTask Scheduling API</h2><p><strong>Background URLSession</strong></p>
<p>在APP未运行的状态下，上传和下载数据。</p>
<p>后台APP刷新，什么是后台APP刷新，在APP未启动的时候，可以刷新数据减少启动时数据刷新等待时间。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-75569253a349ac6f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="BackgroundAPPRefreshAction"></p>
<blockquote>
<ol>
<li>在APP运行时设置在后台APP刷新需要更新的数据</li>
<li>APP关闭时，URLSessionTask更新数据</li>
<li>打开APP，看到后台刷新的数据</li>
</ol>
</blockquote>
<p>上述方法存在几个问题</p>
<ul>
<li>额外的launch影响电池寿命</li>
<li>无法预知未来的变化，请求下来数据可能无用</li>
<li>数据包大小问题</li>
</ul>
<p>为了解决上述问题，提出了URLSessionTask调度API。为URLSessionTask新属性<code>var earlistBeginDate:Date?</code>设置一个时间，允许任务准备好开始运行。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-9d7982950b69393f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="earlistBeginDate"></p>
<p>添加这个属性上述后台APP刷新则变为：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-d0ed407dac3b8d88.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Background APP Refresh"></p>
<p>新的URLSessionTaskDelegate方法 <code>urlSession(_:task:willBeginDelayedRequest:completionHandler:)</code><br>当系统准备联网有机会改变请求。</p>
<p>指定URLSessionTask的传输数据量，可以让系统更好的进行调度。</p>
<p>URLSessionTask的两个新属性：</p>
<ul>
<li><code>var countOfBytesClientExpectsToSend: Int64</code></li>
<li><code>var countOfBytesClientExpectsToReceive; Int64</code><br>给出最适当的值或者设定为<code>NSURLSessionTransferSizeUnknown</code>。</li>
</ul>
<p>下面看一下示例代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-adfeae454d590f14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-6fb43dc5d989ea39.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<h2 id="2-4-URLSession的改进"><a href="#2-4-URLSession的改进" class="headerlink" title="2.4 URLSession的改进"></a>2.4 URLSession的改进</h2><p>更新内容</p>
<ol>
<li>进度更新</li>
<li>Brotli 压缩</li>
<li>公开后缀列表更新</li>
<li>URLSessionStreamTask和认证代理</li>
</ol>
<h3 id="2-4-1-URLSessionTask-Progress-Tracking"><a href="#2-4-1-URLSessionTask-Progress-Tracking" class="headerlink" title="2.4.1 URLSessionTask Progress Tracking"></a>2.4.1 URLSessionTask Progress Tracking</h3><p>旧的进度计算的API。</p>
<p>UIRLSession API额外的工作。<br>键值观察设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">countOfBytesExpectedToReceive, countOfBytesReceived</span><br><span class="line">countOfBytesExpectedToSend, countOfBytesSent</span><br></pre></td></tr></table></figure>
<p>不总是可用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">countOfBytesExpectedToReceive</span><br><span class="line">countOfBytesExpectedToSend</span><br></pre></td></tr></table></figure>

<h3 id="2-4-2-URLSessionTask-Adopts-ProgressReporting"><a href="#2-4-2-URLSessionTask-Adopts-ProgressReporting" class="headerlink" title="2.4.2 URLSessionTask Adopts ProgressReporting"></a>2.4.2 URLSessionTask Adopts ProgressReporting</h3><p>新的PregressReporting协议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class URLSessionTask: NSObject,NSCopying, ProgressReporting</span><br><span class="line">public var progress:Progress&#123;get&#125;</span><br><span class="line"></span><br><span class="line">var fractionCompleted: Double [0.0,1.0]</span><br><span class="line"></span><br><span class="line">// 普通和指定的进度描述</span><br><span class="line">var localizedDescription: String!</span><br><span class="line">var localizedAdditionalDescription: String!</span><br></pre></td></tr></table></figure>

<p>可以添加到UIProgressView或者NSProgressIndicator<br>通过使用父进度对象来进行多个任务<br>键值观察和Cocoa绑定</p>
<p>URLSessionTask和Progress对象状态管理</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/1363078-81788cb55d81cfee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<h3 id="2-4-3-URLSession-Brotli-Support"><a href="#2-4-3-URLSession-Brotli-Support" class="headerlink" title="2.4.3 URLSession Brotli Support"></a>2.4.3 URLSession Brotli Support</h3><p>Brotli数据压缩<br>Content-Encoding: br<br>Faster URL loads<br>Requires HTTPS(TLS)</p>
<h3 id="2-4-4-URLSession-Public-Suffix-List"><a href="#2-4-4-URLSession-Public-Suffix-List" class="headerlink" title="2.4.4 URLSession Public Suffix List"></a>2.4.4 URLSession Public Suffix List</h3><h3 id="2-4-5-URLSessionStreamTask"><a href="#2-4-5-URLSessionStreamTask" class="headerlink" title="2.4.5 URLSessionStreamTask"></a>2.4.5 URLSessionStreamTask</h3><ul>
<li>允许直接TCP&#x2F;IP连接</li>
<li>可选安全握手</li>
<li>转换能力 NSInputStream&#x2F;NSOutputStream </li>
<li>建议新代码中使用 URLSessionStreamTask</li>
<li>验证HTTPS代理的导航</li>
</ul>
<p>##3 拓展</p>
<p><strong>TLS</strong> ： 传输层安全协议（Transport Layer Security），及其前身<strong>安全套接触</strong>（Secure Sockert Layer, SSL）是一种安全协议，目的是为互联网通信，提供安全及数据完整性保障。</p>
<p>Reference：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html">URLSession Programming Guide</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/documentation/NetworkingInternetWeb/Conceptual/NetworkingOverview/Introduction/Introduction.html#//apple_ref/doc/uid/TP40010220-CH12-BBCFIHFH">About Networking</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/foundation/urlsessionconfiguration">URLSessionConfiguration</a></li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2021/01/15/419597cf3b2ff.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2021/01/15/419597cf3b2ff.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">繁华落尽丶千</div><div class="post-copyright__author_desc">面朝大海 春暖花开</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://juesuslove.github.io/2017/09/01/iOS%E7%BD%91%E7%BB%9C%E6%9B%B4%E6%96%B0WWDC/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://juesuslove.github.io/2017/09/01/iOS%E7%BD%91%E7%BB%9C%E6%9B%B4%E6%96%B0WWDC/')">iOS网络更新WWDC</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/images/wechatpay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/wechatpay.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/images/alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://juesuslove.github.io/2017/09/01/iOS%E7%BD%91%E7%BB%9C%E6%9B%B4%E6%96%B0WWDC/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=iOS网络更新WWDC&amp;url=https://juesuslove.github.io/2017/09/01/iOS%E7%BD%91%E7%BB%9C%E6%9B%B4%E6%96%B0WWDC/&amp;pic=https://bu.dusays.com/2023/11/03/6544702016eb3.png?_r_=99893846-ae43-7095-dd4d-f1798b97798f" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://juesusLove.github.io" target="_blank">繁华落尽</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/iOS/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>iOS<span class="tagsPageCount">18</span></a><a class="post-meta__box__tags" href="/tags/WWDC/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>WWDC<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/11/04/654606ec99646.webp" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2017/08/07/Python3%E8%BF%9B%E9%98%B6%EF%BC%9A%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%E4%BA%8C/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/11/03/6544702016eb3.png?_r_=21bf5f32-8ccd-77ac-f143-0451e224b1f6" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Python3进阶：高级特性二</div></div></a></div><div class="next-post pull-right"><a href="/2017/10/17/Alamofire%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/11/03/6544702016eb3.png?_r_=e96b1caa-7459-bc98-16b7-b36720d2ca07" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Alamofire源码笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2019/02/25/Runtime%E5%9B%9E%E9%A1%BE%E7%AC%94%E8%AE%B0/" title="iOS开发进阶：Runtime"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/11/03/6544702016eb3.png?_r_=59f30fe1-f520-8f0c-d48c-11a65ec72285" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2019-02-25</div><div class="title">iOS开发进阶：Runtime</div></div></a></div><div><a href="/2016/11/04/WebViewJavascriptBaridge%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/" title="WebViewJavascriptBridge使用总结"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/11/03/6544702016eb3.png?_r_=5b501535-f49a-d3af-cefd-6e9ef4cb858f" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2016-11-04</div><div class="title">WebViewJavascriptBridge使用总结</div></div></a></div><div><a href="/2017/12/21/YYModel%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B8%80/" title="从YYModel源码中可以学到什么：前篇"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/11/03/6544702016eb3.png?_r_=304f443d-43a4-e0ad-62f1-ddae66d5a5b2" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2017-12-21</div><div class="title">从YYModel源码中可以学到什么：前篇</div></div></a></div><div><a href="/2017/12/27/YYModel%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%BA%8C/" title="从YYModel源码中可以学到什么：后篇"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/11/03/6544702016eb3.png?_r_=b974eb7f-47a1-b5dd-4362-3cc232ad5205" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2017-12-27</div><div class="title">从YYModel源码中可以学到什么：后篇</div></div></a></div><div><a href="/2017/11/01/iOS%E5%80%BC%E5%BE%97%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%89%E6%96%B9%E5%BA%93/" title="iOS值得学习的三方库"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/11/03/6544702016eb3.png?_r_=4e476a0c-4212-d5fa-d94b-cffa5a5757ac" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2017-11-01</div><div class="title">iOS值得学习的三方库</div></div></a></div><div><a href="/2017/07/25/iOS%E5%BC%80%E5%8F%91%E4%B9%8B%E9%9D%99%E6%80%81%E5%BA%93/" title="iOS开发之静态库"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/11/03/6544702016eb3.png?_r_=a8bb3046-5174-ec6c-31a2-c3489554eb3f" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2017-07-25</div><div class="title">iOS开发之静态库</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2021/01/15/419597cf3b2ff.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2021/03/03/317b790a902ec.png" ait="status"/></div></div><div class="author-info__description">一名 90 后程序员大叔</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">繁华落尽丶千</h1><div class="author-info__desc">面朝大海 春暖花开</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/jesusLove" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/11/03/65446bda8f5e5.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#2015WWDC"><span class="toc-number">1.</span> <span class="toc-text">2015WWDC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.</span> <span class="toc-text">1 网络传输安全问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-URL%E4%BC%9A%E8%AF%9D%E5%92%8CHTTP%E5%8D%8F%E8%AE%AE%E7%9A%84%E8%83%8C%E6%99%AF"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 URL会话和HTTP协议的背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-App-Transport-Security"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 App Transport Security</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-URLSession%E6%B7%BB%E5%8A%A0%E4%BA%86%E5%93%AA%E4%BA%9B%E6%96%B0%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.</span> <span class="toc-text">1.3 URLSession添加了哪些新的协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-URLSession-API%E5%8F%98%E5%8C%96"><span class="toc-number">1.3.</span> <span class="toc-text">1.4 URLSession API变化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%A1%A5%E5%85%85"><span class="toc-number">1.4.</span> <span class="toc-text">2. 补充</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">1.4.1.</span> <span class="toc-text">2.1 知识点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Reference"><span class="toc-number">1.5.</span> <span class="toc-text">3 Reference</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2017WWDC"><span class="toc-number">2.</span> <span class="toc-text">2017WWDC</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Advances-in-Networking-Part-1"><span class="toc-number">3.</span> <span class="toc-text">1. Advances in Networking Part 1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-ECN-%E6%98%BE%E5%BC%8F%E6%8B%A5%E5%A1%9E%E9%80%9A%E7%9F%A5"><span class="toc-number">3.1.</span> <span class="toc-text">1.1 ECN (显式拥塞通知)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-IPv6-NAT64"><span class="toc-number">3.2.</span> <span class="toc-text">1.2 IPv6 &#x2F; NAT64</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-User-Space-Networking%EF%BC%88%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4%E7%BD%91%E7%BB%9C%EF%BC%89"><span class="toc-number">3.3.</span> <span class="toc-text">1.3 User-Space Networking（用户空间网络）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-Network-Extension"><span class="toc-number">3.4.</span> <span class="toc-text">1.4 Network Extension</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%E5%A4%9A%E8%B7%AF%E5%BE%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">3.5.</span> <span class="toc-text">1.5 多路径协议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Advances-in-Networking-Part-2"><span class="toc-number">4.</span> <span class="toc-text">2. Advances in Networking Part 2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-URLSession%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.1.</span> <span class="toc-text">2.1  URLSession介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-URLSession-Adaptable-Connectivity-API"><span class="toc-number">4.2.</span> <span class="toc-text">2.2 URLSession Adaptable Connectivity API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-URLSessionTask-Scheduling-API"><span class="toc-number">4.3.</span> <span class="toc-text">2.3 URLSessionTask Scheduling API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-URLSession%E7%9A%84%E6%94%B9%E8%BF%9B"><span class="toc-number">4.4.</span> <span class="toc-text">2.4 URLSession的改进</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-URLSessionTask-Progress-Tracking"><span class="toc-number">4.4.1.</span> <span class="toc-text">2.4.1 URLSessionTask Progress Tracking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-URLSessionTask-Adopts-ProgressReporting"><span class="toc-number">4.4.2.</span> <span class="toc-text">2.4.2 URLSessionTask Adopts ProgressReporting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-3-URLSession-Brotli-Support"><span class="toc-number">4.4.3.</span> <span class="toc-text">2.4.3 URLSession Brotli Support</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-4-URLSession-Public-Suffix-List"><span class="toc-number">4.4.4.</span> <span class="toc-text">2.4.4 URLSession Public Suffix List</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-5-URLSessionStreamTask"><span class="toc-number">4.4.5.</span> <span class="toc-text">2.4.5 URLSessionStreamTask</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/11/08/Vue-js%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%AE%9E%E7%8E%B04-2-md/" title="Vue.js设计与实现：响应式系统的作用与实现 4-2"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/11/04/654606ec99646.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue.js设计与实现：响应式系统的作用与实现 4-2"/></a><div class="content"><a class="title" href="/2023/11/08/Vue-js%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%AE%9E%E7%8E%B04-2-md/" title="Vue.js设计与实现：响应式系统的作用与实现 4-2">Vue.js设计与实现：响应式系统的作用与实现 4-2</a><time datetime="2023-11-08T06:38:46.000Z" title="发表于 2023-11-08 14:38:46">2023-11-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/03/Vuejs%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%EF%BC%9A%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%AE%9E%E7%8E%B04-1/" title="Vue.js设计与实现：响应式系统的作用与实现 4-1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/11/04/654606ec99646.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue.js设计与实现：响应式系统的作用与实现 4-1"/></a><div class="content"><a class="title" href="/2023/11/03/Vuejs%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%EF%BC%9A%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%AE%9E%E7%8E%B04-1/" title="Vue.js设计与实现：响应式系统的作用与实现 4-1">Vue.js设计与实现：响应式系统的作用与实现 4-1</a><time datetime="2023-11-03T10:49:44.000Z" title="发表于 2023-11-03 18:49:44">2023-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/07/13/Koa%E4%BD%BF%E7%94%A8Sqlite3%E5%92%8CSequelize/" title="Koa使用Sqlite3和Sequelize"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/11/03/6544702016eb3.png?_r_=106100d7-c486-3d38-5129-002801b6156a" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Koa使用Sqlite3和Sequelize"/></a><div class="content"><a class="title" href="/2020/07/13/Koa%E4%BD%BF%E7%94%A8Sqlite3%E5%92%8CSequelize/" title="Koa使用Sqlite3和Sequelize">Koa使用Sqlite3和Sequelize</a><time datetime="2020-07-13T02:16:06.000Z" title="发表于 2020-07-13 10:16:06">2020-07-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/07/13/Electron%E5%AD%90%E8%BF%9B%E7%A8%8B%E5%BC%80%E5%90%AFKoa%E5%BE%AE%E6%9C%8D%E5%8A%A1/" title="Electron子进程开启Koa微服务"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/11/03/6544702016eb3.png?_r_=0410c189-3743-23cf-508c-8840124c65bd" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Electron子进程开启Koa微服务"/></a><div class="content"><a class="title" href="/2020/07/13/Electron%E5%AD%90%E8%BF%9B%E7%A8%8B%E5%BC%80%E5%90%AFKoa%E5%BE%AE%E6%9C%8D%E5%8A%A1/" title="Electron子进程开启Koa微服务">Electron子进程开启Koa微服务</a><time datetime="2020-07-13T02:09:01.000Z" title="发表于 2020-07-13 10:09:01">2020-07-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/07/13/Electron%E6%89%98%E7%9B%98-%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8/" title="Electron托盘&amp;开机自启动"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/11/03/6544702016eb3.png?_r_=7b7213ac-75bc-572c-b09b-ced03ab78ac5" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Electron托盘&amp;开机自启动"/></a><div class="content"><a class="title" href="/2020/07/13/Electron%E6%89%98%E7%9B%98-%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8/" title="Electron托盘&amp;开机自启动">Electron托盘&amp;开机自启动</a><time datetime="2020-07-13T01:19:10.000Z" title="发表于 2020-07-13 09:19:10">2020-07-13</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2023 By <a class="footer-bar-link" href="/" title="繁华落尽丶千" target="_blank">繁华落尽丶千</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" title="鲁ICP备19057856号-1">鲁ICP备19057856号-1</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">69</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">64</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">8</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于我</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Alamofire/" style="font-size: 0.88rem;">Alamofire<sup>1</sup></a><a href="/tags/CoreAnimation/" style="font-size: 0.88rem;">CoreAnimation<sup>1</sup></a><a href="/tags/Electron/" style="font-size: 0.88rem;">Electron<sup>2</sup></a><a href="/tags/Flexbox/" style="font-size: 0.88rem;">Flexbox<sup>1</sup></a><a href="/tags/Git/" style="font-size: 0.88rem;">Git<sup>3</sup></a><a href="/tags/Git%E9%97%AE%E9%A2%98/" style="font-size: 0.88rem;">Git问题<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>8</sup></a><a href="/tags/Koa/" style="font-size: 0.88rem;">Koa<sup>2</sup></a><a href="/tags/Node-js/" style="font-size: 0.88rem;">Node.js<sup>1</sup></a><a href="/tags/Python3/" style="font-size: 0.88rem;">Python3<sup>8</sup></a><a href="/tags/Runtime/" style="font-size: 0.88rem;">Runtime<sup>2</sup></a><a href="/tags/Swift/" style="font-size: 0.88rem;">Swift<sup>5</sup></a><a href="/tags/TypeScript/" style="font-size: 0.88rem;">TypeScript<sup>4</sup></a><a href="/tags/Vue-js/" style="font-size: 0.88rem;">Vue.js<sup>2</sup></a><a href="/tags/iOS/" style="font-size: 0.88rem;">iOS<sup>18</sup></a><a href="/tags/this-%E7%BB%91%E5%AE%9A/" style="font-size: 0.88rem;">this 绑定<sup>1</sup></a><a href="/tags/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/" style="font-size: 0.88rem;">事件循环<sup>1</sup></a><a href="/tags/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE/" style="font-size: 0.88rem;">作用域链<sup>1</sup></a><a href="/tags/%E5%8E%9F%E5%9E%8B/" style="font-size: 0.88rem;">原型<sup>1</sup></a><a href="/tags/%E5%8E%9F%E5%9E%8B%E9%93%BE/" style="font-size: 0.88rem;">原型链<sup>2</sup></a><a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/" style="font-size: 0.88rem;">响应式原理<sup>2</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE/" style="font-size: 0.88rem;">基础数据<sup>1</sup></a><a href="/tags/%E5%AF%B9%E8%B1%A1/" style="font-size: 0.88rem;">对象<sup>1</sup></a><a href="/tags/%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF/" style="font-size: 0.88rem;">开机自启<sup>1</sup></a><a href="/tags/%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1/" style="font-size: 0.88rem;">异步任务<sup>1</sup></a><a href="/tags/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87/" style="font-size: 0.88rem;">执行上下文<sup>1</sup></a><a href="/tags/%E6%89%A7%E8%A1%8C%E6%A0%88/" style="font-size: 0.88rem;">执行栈<sup>1</sup></a><a href="/tags/%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0/" style="font-size: 0.88rem;">构造函数<sup>1</sup></a><a href="/tags/%E6%A0%87%E5%87%86%E5%BA%93/" style="font-size: 0.88rem;">标准库<sup>1</sup></a><a href="/tags/%E6%A8%A1%E5%9D%97/" style="font-size: 0.88rem;">模块<sup>2</sup></a><a href="/tags/%E6%B3%9B%E5%9E%8B/" style="font-size: 0.88rem;">泛型<sup>1</sup></a><a href="/tags/%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/" style="font-size: 0.88rem;">深浅拷贝<sup>1</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F%E6%89%98%E7%9B%98/" style="font-size: 0.88rem;">系统托盘<sup>1</sup></a><a href="/tags/%E7%BB%A7%E6%89%BF/" style="font-size: 0.88rem;">继承<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%BA%93/" style="font-size: 0.88rem;">网络库<sup>1</sup></a><a href="/tags/%E8%A7%A3%E6%9E%90%E5%BA%93/" style="font-size: 0.88rem;">解析库<sup>1</sup></a><a href="/tags/%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/" style="font-size: 0.88rem;">输入输出<sup>1</sup></a><a href="/tags/%E9%97%AD%E5%8C%85/" style="font-size: 0.88rem;">闭包<sup>1</sup></a><a href="/tags/%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/" style="font-size: 0.88rem;">高级特性<sup>2</sup></a><a href="/tags/%E9%AB%98%E7%BA%A7%E7%B1%BB%E5%9E%8B/" style="font-size: 0.88rem;">高级类型<sup>1</sup></a></div></div><hr/></div></div><div id="keyboard-tips"><div class="keyboardTitle">博客快捷键</div><div class="keybordList"><div class="keybordItem"><div class="keyGroup"><div class="key">shift K</div></div><div class="keyContent"><div class="content">关闭快捷键功能</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift A</div></div><div class="keyContent"><div class="content">打开/关闭中控台</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift M</div></div><div class="keyContent"><div class="content">播放/暂停音乐</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift D</div></div><div class="keyContent"><div class="content">深色/浅色显示模式</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift S</div></div><div class="keyContent"><div class="content">站内搜索</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift R</div></div><div class="keyContent"><div class="content">随机访问</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift H</div></div><div class="keyContent"><div class="content">返回首页</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift F</div></div><div class="keyContent"><div class="content">友链鱼塘</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift L</div></div><div class="keyContent"><div class="content">友链页面</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift P</div></div><div class="keyContent"><div class="content">关于本站</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift I</div></div><div class="keyContent"><div class="content">原版/本站右键菜单</div></div></div></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>